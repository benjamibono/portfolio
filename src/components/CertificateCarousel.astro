---
import { Image } from 'astro:assets';
---

<div class="w-full max-w-4xl mx-auto p-4 fade-in" style="animation-delay: 100ms">
  <div class="carousel-container relative">
    <div
      class="carousel-track flex overflow-x-auto snap-x snap-mandatory scroll-smooth gap-4 scrollbar-hide"
      id="carousel-track"
    >
      <div class="carousel-slide flex-shrink-0 w-full snap-center">
        <div
          class="relative aspect-[4/3] rounded-lg overflow-hidden border border-border dark:border-darkborder"
        >
          <Image
            src="/certificates/Responsive-Web-Design.webp"
            alt="Responsive Web Design Certificate"
            class="object-contain w-full h-full"
            width={800}
            height={600}
            loading="eager"
            format="webp"
            quality={90}
          />
        </div>
      </div>
      <div class="carousel-slide flex-shrink-0 w-full snap-center">
        <div
          class="relative aspect-[4/3] rounded-lg overflow-hidden border border-border dark:border-darkborder"
        >
          <Image
            src="/certificates/Algorithms-DataStructures.webp"
            alt="Algorithms & Data Structures Certificate"
            class="object-contain w-full h-full"
            width={800}
            height={600}
            loading="lazy"
            format="webp"
            quality={90}
          />
        </div>
      </div>
      <div class="carousel-slide flex-shrink-0 w-full snap-center">
        <div
          class="relative aspect-[4/3] rounded-lg overflow-hidden border border-border dark:border-darkborder bg-white dark:bg-darkgrey flex flex-col items-center justify-center p-8 text-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-black dark:text-white mb-4"
          >
            <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
            <path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path>
            <path d="M9 9h1"></path>
            <path d="M9 13h6"></path>
            <path d="M9 17h6"></path>
          </svg>
          <h3 class="text-xl font-bold text-black dark:text-white mb-2">
            Full Stack Development Certificate
          </h3>
          <p class="text-lighttext dark:text-darktext mb-4">
            Click the button below to view the PDF certificate
          </p>
          <a
            href="/certificates/Full-Stack.pdf"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 bg-black dark:bg-white text-white dark:text-darkgrey px-4 py-2 rounded-lg hover:bg-darkborder hover:dark:bg-white transition duration-300"
            aria-label="Download Full Stack Development Certificate"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            View Certificate
          </a>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <button
      class="carousel-button carousel-button-prev absolute left-2 top-1/2 -translate-y-1/2 bg-white dark:bg-black bg-opacity-80 dark:bg-opacity-80 text-black dark:text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md hover:bg-opacity-100 transition z-10"
      aria-label="Previous certificate"
      id="prev-btn"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button
      class="carousel-button carousel-button-next absolute right-2 top-1/2 -translate-y-1/2 bg-white dark:bg-black bg-opacity-80 dark:bg-opacity-80 text-black dark:text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md hover:bg-opacity-100 transition z-10"
      aria-label="Next certificate"
      id="next-btn"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>

    <!-- Pagination Dots -->
    <div class="carousel-pagination flex justify-center gap-2 mt-4" id="pagination">
      <button
        class="pagination-dot w-2 h-2 rounded-full bg-black dark:bg-white transition"
        data-index="0"
        aria-label="Go to certificate 1"
      ></button>
      <button
        class="pagination-dot w-2 h-2 rounded-full bg-black dark:bg-white opacity-30 transition"
        data-index="1"
        aria-label="Go to certificate 2"
      ></button>
      <button
        class="pagination-dot w-2 h-2 rounded-full bg-black dark:bg-white opacity-30 transition"
        data-index="2"
        aria-label="Go to certificate 3"
      ></button>
    </div>
  </div>
</div>

<script>
  const track = document.getElementById('carousel-track');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const dots = document.querySelectorAll('.pagination-dot');
  let currentIndex = 0;
  const totalSlides = 3;

  function scrollToSlide(index: number) {
    if (!track) return;
    const slideWidth = track.offsetWidth;
    track.scrollTo({
      left: slideWidth * index,
      behavior: 'smooth',
    });
    currentIndex = index;
    updatePagination();
  }

  function updatePagination() {
    dots.forEach((dot, i) => {
      if (i === currentIndex) {
        dot.classList.remove('opacity-30');
        dot.classList.add('opacity-100');
      } else {
        dot.classList.remove('opacity-100');
        dot.classList.add('opacity-30');
      }
    });
  }

  prevBtn?.addEventListener('click', () => {
    const newIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
    scrollToSlide(newIndex);
  });

  nextBtn?.addEventListener('click', () => {
    const newIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
    scrollToSlide(newIndex);
  });

  dots.forEach((dot) => {
    dot.addEventListener('click', () => {
      const index = parseInt(dot.getAttribute('data-index') || '0');
      scrollToSlide(index);
    });
  });

  // Keyboard navigation
  track?.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      prevBtn?.click();
    } else if (e.key === 'ArrowRight') {
      nextBtn?.click();
    }
  });

  // Update pagination on scroll
  track?.addEventListener('scroll', () => {
    if (!track) return;
    const slideWidth = track.offsetWidth;
    const newIndex = Math.round(track.scrollLeft / slideWidth);
    if (newIndex !== currentIndex) {
      currentIndex = newIndex;
      updatePagination();
    }
  });
</script>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  .pagination-dot.opacity-100 {
    background-color: var(--color-purple);
  }
</style>
